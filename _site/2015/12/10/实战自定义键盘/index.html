
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>实战自定义键盘</title>
    
    <meta name="author" content="qihuifeng">

    <!-- Enable responsive viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Bootstrap styles -->
    <link href="/assets/themes/bootstrap-3/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <!-- Optional theme -->
    <link href="/assets/themes/bootstrap-3/bootstrap/css/bootstrap-theme.min.css" rel="stylesheet">
    <!-- Sticky Footer -->
    <link href="/assets/themes/bootstrap-3/bootstrap/css/bs-sticky-footer.css" rel="stylesheet">
    
    <!-- Custom styles -->
    <link href="/assets/themes/bootstrap-3/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <!-- Fav and touch icons -->
    <!-- Update these with your own images
      <link rel="shortcut icon" href="images/favicon.ico">
      <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
      <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
      <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
    -->

    <!-- atom & rss feed -->
    <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
    <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">

  </head>

  <body>
    <div id="wrap">
      <nav class="navbar navbar-default" role="navigation">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#jb-navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">qihuifeng的个人站点</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="jb-navbar-collapse">
          <ul class="nav navbar-nav">
            
            
            


  
    
      
      	
      	<li><a href="/archive.html">Archive</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/categories.html">Categories</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/pages.html">Pages</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/tags.html">Tags</a></li>
      	
      
    
  



          </ul>
          <form class="navbar-form navbar-right" role="search">
            <div class="form-group">
              <input type="text" class="form-control" placeholder="Search">
            </div>
            <button type="submit" class="btn btn-default">Submit</button>
          </form>
        </div><!-- /.navbar-collapse -->
      </nav>

      <div class="container">
        
<div class="page-header">
  <h1>实战自定义键盘 </h1>
</div>

<div class="row-fluid post-full">
  <div class="span12">
    <div class="date">
      <span>10 December 2015</span>
    </div>
    <div class="content">
      <h1 id="section">实战自定义键盘</h1>

<h1 id="x01-">0x01 来龙去脉</h1>
<p>在iOS8之前，iOS系统的输入法只能使用苹果官方提供的输入法。
对于中文来说，官方的输入法并不好用，或者说不够好用，词库，联想，云输入等都没有或者和搜狗输入法，百度输入法等有中国特色的输入法相比有一定的差距。
部分用户因为输入法的原因，选择了安卓等其他系统，或者选择了越狱。
iOS自定义键盘是iOS8系统新推出的功能，允许开发者开发第三方键盘。众人拾柴火焰高，功能的开放，为iOS用户体验的提示必然带来更大的推动。</p>

<h1 id="x02-">0x02 输入法的基本结构</h1>
<p><img src="/assets/img/2015-12-10/87C7503826A1E52EA198D713F27CCD5C.png" alt="自定义键盘.png" /></p>

<p>输入法的项目可以使用普通的project模版，但是需要增加一个自定义键盘的Target，所有的人机交互，都在项目生成的UIInputViewController一个子类里实现。关键的要素如下：
* 一个Xcode的Project
* 一个自定义键盘的Target
* 一个UIInputViewController的子类
* 必须提供一个明显的切换到其他输入法的按钮</p>

<h1 id="x03-">0x03 功能需求描述</h1>
<ol>
  <li>键盘上提供一个按钮，点击之后输入“一支红杏出墙来”</li>
</ol>

<h1 id="x04-">0x04 软件设计</h1>

<p>```sequence
title:软件使用流程
用户–&gt;系统:切换输入法
系统–&gt;app:展示键盘
app–&gt;控制器:展示”一支红杏出墙来”按钮
app–&gt;控制器:展示”切换输入法”按钮
用户–&gt;控制器:点击“一只红杏出墙来”按钮
控制器–&gt;app:在当前的输入区域中中输入“一枝红杏出墙来”</p>

<p>```</p>

<h1 id="x05-">0x05 实现</h1>
<p>## 0x0501. 建立一个单视图的project
<img src="/assets/img/2015-12-10/9D8A924360BAD321435A43A0E055946E.png" alt="屏幕快照 2015-12-03 下午3.17.36.png" />
## 0x0502. 增加一个自定义键盘的target(Custom Keyboard)
<img src="/assets/img/2015-12-10/523C550AD17BFCF6382A11D63DEB70CB.png" alt="屏幕快照 2015-12-03 下午3.19.25.png" />
添加之后，会看到有一个文件：KeyboardViewController，这是我们的主战场
<img src="/assets/img/2015-12-10/A1B535C54EB087327FFD1536F79556FF.png" alt="屏幕快照 2015-12-03 下午3.22.19.png" />
## 0x0503. 编辑代码
代码的内容很简单，创建两个按钮，一个点击之后，切换输入法，一个点击之后，向当前输入控件里添加”一枝红杏出墙来”</p>

<p>```swift
//
//  KeyboardViewController.swift
//  keyboard
//
//  Created by qi on 15/12/3.
//  Copyright © 2015年 im.windgo. All rights reserved.
//</p>

<p>import UIKit</p>

<p>class KeyboardViewController: UIInputViewController {</p>

<pre><code>@IBOutlet var nextKeyboardButton: UIButton! //切换输入法
@IBOutlet var yizhihongxingButton: UIButton! //输入一支红杏出墙来的按钮
override func updateViewConstraints() {
    super.updateViewConstraints()

    // Add custom view sizing constraints here
}

override func viewDidLoad() {
    super.viewDidLoad()

    // Perform custom UI setup here

    //创建切换到另一个键盘的按钮
    self.nextKeyboardButton = UIButton(type: .System)
    self.nextKeyboardButton.setTitle(NSLocalizedString("切换键盘", comment: "切换到下一个键盘的按钮"), forState: .Normal)
    self.nextKeyboardButton.sizeToFit()
    self.nextKeyboardButton.translatesAutoresizingMaskIntoConstraints = false
    self.nextKeyboardButton.addTarget(self, action: "advanceToNextInputMode", forControlEvents: .TouchUpInside)
    self.view.addSubview(self.nextKeyboardButton)

    let nextKeyboardButtonLeftSideConstraint = NSLayoutConstraint(item: self.nextKeyboardButton, attribute: .Left, relatedBy: .Equal, toItem: self.view, attribute: .Left, multiplier: 1.0, constant: 0.0)
    let nextKeyboardButtonBottomConstraint = NSLayoutConstraint(item: self.nextKeyboardButton, attribute: .Bottom, relatedBy: .Equal, toItem: self.view, attribute: .Bottom, multiplier: 1.0, constant: 0.0)
    self.view.addConstraints([nextKeyboardButtonLeftSideConstraint, nextKeyboardButtonBottomConstraint])


    yizhihongxingButton=UIButton()
    yizhihongxingButton.backgroundColor=UIColor.magentaColor()
    yizhihongxingButton.setTitle("一支红杏出墙来！", forState: UIControlState.Normal)
    yizhihongxingButton.frame=CGRectMake(0, 40, UIScreen.mainScreen().bounds.width, 100)
    yizhihongxingButton.addTarget(self, action: "onInputText", forControlEvents: UIControlEvents.TouchUpInside)
    self.view.addSubview(yizhihongxingButton)


}


override func didReceiveMemoryWarning() {
    super.didReceiveMemoryWarning()
    // Dispose of any assets/img/2015-12-10 that can be recreated
}

override func textWillChange(textInput: UITextInput?) {
    // The app is about to change the document's contents. Perform any preparation here.
}

override func textDidChange(textInput: UITextInput?) {
    // The app has just changed the document's contents, the document context has been updated.

    var textColor: UIColor
    let proxy = self.textDocumentProxy
    if proxy.keyboardAppearance == UIKeyboardAppearance.Dark {
        textColor = UIColor.whiteColor()
    } else {
        textColor = UIColor.blackColor()
    }
    self.nextKeyboardButton.setTitleColor(textColor, forState: .Normal)
}

func onInputText(){
    self.textDocumentProxy.insertText("一支红杏出墙来！")
}
</code></pre>

<p>```</p>

<h2 id="x05004-">0x05004. 运行代码</h2>
<ul>
  <li>选择运行的target
<img src="/assets/img/2015-12-10/B241B2B3643438EAADECE3EB8034350F.png" alt="屏幕快照 2015-12-03 下午3.48.20.png" /></li>
  <li>执行会让你选择在哪个应用里使用键盘，选择Safari浏览器就可以了
<img src="/assets/img/2015-12-10/055B237E16D90ED65AC280C69A3100DF.png" alt="屏幕快照 2015-12-03 下午3.51.13.png" /></li>
  <li>选择地址栏，进入输入状态，可以看到键盘，点击会输入“一支红杏出墙来！”</li>
  <li><img src="/assets/img/2015-12-10/E6B2F972F8D4D1EBF8972A4D3C0ECD6B.png" alt="屏幕快照 2015-12-03 下午3.53.06.png" /></li>
</ul>

<blockquote>
  <p>注意：如果看不到键盘，可以切换下输入法，如果输入法里面没有，需要到“设置”里面将键盘加入。</p>
</blockquote>

<blockquote>
  <p>更深入的技术细节：英文号的可以看<a href="https://developer.apple.com/library/ios/documentation/General/Conceptual/ExtensibilityPG/Keyboard.html">官方文档</a>
喜欢看中文的可以看<a href="http://www.cocoachina.com/ios/20140918/9677.html">翻译官方文档</a></p>
</blockquote>

    </div>

  

  

    <hr>
    <div class="pagination">
      <ul>
      
        <li class="prev"><a href="/2015/12/02/%E5%BC%80%E5%A7%8B%E5%BE%80%E8%BF%99%E9%87%8C%E8%BF%81%E7%A7%BB%E5%8D%9A%E5%AE%A2" title="测试测试测试">&larr; Previous</a></li>
      
        <li><a href="/archive.html">Archive</a></li>
      
        <li class="next disabled"><a>Next &rarr;</a>
      
      </ul>
    </div>
    <hr>
  </div>
</div>


      </div>

    </div>

    <div id="footer">
      <div class="container">
        <p>&copy; 2015 qihuifeng
          with help from <a href="http://jekyllbootstrap.com" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a>
          and <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>
        </p>
      </div>
    </div>

    





    <!-- Latest compiled and minified JavaScript, requires jQuery 1.x (2.x not supported in IE8) -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script src="/assets/themes/bootstrap-3/bootstrap/js/bootstrap.min.js"></script>
  </body>
</html>

